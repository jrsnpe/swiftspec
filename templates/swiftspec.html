<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SwiftSpec - Your Awe-Inspiring APIs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/monokai.min.css" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.6;
        color: #3b4151;
        background-color: #f8f9fa;
      }
      #header {
        background-color: #0056b3;
        color: white;
        padding: 20px;
      }
      #content {
        display: flex;
        min-height: calc(100vh - 60px);
      }
      #sidebar {
        width: 300px;
        background-color: #f8f9fa;
        border-right: 1px solid #dee2e6;
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
      }
      #main {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto;
      }
      .api-item {
        background-color: #fff;
        border: 1px solid #dee2e6;
        margin-bottom: 20px;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
      }
      .api-item-header {
        display: flex;
        align-items: center;
        padding: 15px;
        cursor: pointer;
        border-bottom: 1px solid #dee2e6;
        transition: background-color 0.3s ease;
      }
      .api-item-header:hover {
        background-color: #f1f3f5;
      }
      .method {
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 14px;
        min-width: 80px;
        text-align: center;
      }
      .get {
        background-color: #61affe;
        color: #fff;
      }
      .post {
        background-color: #49cc90;
        color: #fff;
      }
      .put {
        background-color: #fca130;
        color: #fff;
      }
      .delete {
        background-color: #f93e3e;
        color: #fff;
      }
      .path {
        font-family: monospace;
        margin-left: 10px;
      }
      .api-item-content {
        padding: 20px;
      }
      .sidebar-item {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #dee2e6;
        transition: background-color 0.3s ease;
      }
      .sidebar-item:hover {
        background-color: #e9ecef;
      }
      .version-tag {
        font-size: 12px;
        background-color: #e7f3fe;
        color: #1e88e5;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 10px;
      }
      .param-required {
        color: #dc3545;
        font-weight: bold;
      }
      .param-optional {
        color: #28a745;
      }
      .auth-required {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 10px;
        margin-bottom: 15px;
      }
      .deprecated {
        text-decoration: line-through;
        color: #6c757d;
      }
      .schema {
        font-family: monospace;
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
      }
      .fade-transition {
        transition: opacity 0.3s ease;
      }
      .format-selector {
        margin-top: 10px;
      }
      .response-body {
        background-color: #1e1e1e;
        border-radius: 4px;
        padding: 15px;
        position: relative;
      }
      .response-body pre {
        margin: 0;
      }
      .response-body code {
        color: #d4d4d4;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
      }
      .copy-button {
        position: absolute;
        top: 5px;
        right: 5px;
        padding: 5px 10px;
        background-color: #4a4a4a;
        color: #ffffff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .copy-button:hover {
        background-color: #5a5a5a;
      }
      .try-it-out-accordion .accordion-button {
        background-color: #007bff;
        color: white;
      }
      .try-it-out-accordion .accordion-button:not(.collapsed) {
        background-color: #0056b3;
        color: white;
      }
      .try-it-out-accordion .accordion-button:focus {
        box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
      }
      .try-it-out-accordion .accordion-button::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23ffffff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
      }
      .nav-tabs .nav-link {
        color: #495057;
      }
      .nav-tabs .nav-link.active {
        font-weight: bold;
      }
      .tab-content {
        padding-top: 20px;
      }
      .hero {
        background: rgb(1, 38, 78);
        background: linear-gradient(180deg, rgba(1, 38, 78, 1) 0%, rgba(0, 86, 179, 1) 100%);
        color: white;
        margin-bottom: 2rem;
      }
      .hero img {
        max-width: 200px;
        margin-bottom: 1rem;
      }
      .hero h1 {
        font-size: 3.5rem;
        font-weight: bold;
      }
      .hero p {
        font-size: 1.5rem;
        opacity: 0.9;
        padding-bottom: 2rem;
      }
      .btn-outline-light:hover {
        background-color: #00a0e9;
        border-color: #00a0e9;
      }
      pre {
        white-space: pre-wrap;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body>
    <div class="hero text-center">
      <img src="assets/swiftspec-logo-w.png" alt="SwiftSpec Logo" class="img-fluid" />
    </div>

    <div id="header" class="d-flex justify-content-between align-items-center">
      <h2 class="text-white m-0">Documentação da API</h2>
      <nav>
        <a href="about.html" class="btn btn-outline-light me-2">Sobre o SwiftSpec</a>
        <a href="execution-report.html" class="btn btn-outline-light">Relatório</a>
      </nav>
    </div>
    <div id="content" class="d-flex">
      <div id="sidebar" class="bg-light p-3">
        <h4>Endpoints</h4>
        <div id="sidebar-content"></div>
      </div>
      <div id="main" class="flex-grow-1 p-4">
        <div id="api-content"></div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Funções auxiliares
        function escapeHtml(unsafe) {
          if (unsafe == null) return "";
          if (typeof unsafe !== "string") unsafe = String(unsafe);
          return unsafe.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }

        function generateMetadataSection(info) {
          return `
      <div class="api-metadata">
        <table class="table">
          <tbody>
            ${info.permission ? `<tr><td>Permission:</td><td>${info.permission.join(", ")}</td></tr>` : ""}
            ${info.deprecated ? `<tr><td>Deprecated:</td><td>Yes</td></tr>` : ""}
          </tbody>
        </table>
      </div>
    `;
        }

        function generateParametersSection(params) {
          if (!Array.isArray(params) || params.length === 0) {
            return "<p>Este endpoint não possui parâmetros.</p>";
          }
          return `
      <table class="table">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Tipo</th>
            <th>Descrição</th>
            <th>Obrigatório</th>
          </tr>
        </thead>
        <tbody>
          ${params
            .map(
              (param) => `
              <tr>
                <td>${param.name}</td>
                <td>${param.type}</td>
                <td>${param.description}</td>
                <td class="${param.optional ? "param-optional" : "param-required"}">${param.optional ? "Não" : "Sim"}</td>
              </tr>
            `
            )
            .join("")}
        </tbody>
      </table>
    `;
        }

        function generateSuccessSection(info) {
          if (!Array.isArray(info.success) || info.success.length === 0) {
            return "";
          }

          const successExample = info.success.find((s) => s.type === "Example");
          let exampleContent = "";

          if (successExample) {
            const exampleMatch = info.description.match(/HTTP\/1\.1 200 OK[\s\S]*?(?=HTTP\/1\.1|$)/);
            if (exampleMatch) {
              const { statusLine, jsonContent } = formatJsonExample({ description: exampleMatch[0].trim() });
              exampleContent = `
        <h4>${escapeHtml(statusLine)}</h4>
        <pre><code class="language-json">${escapeHtml(jsonContent)}</code></pre>
      `;
            }
          }

          return `
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingSuccess">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSuccess" aria-expanded="false" aria-controls="collapseSuccess">
          Resposta de Sucesso
        </button>
      </h2>
      <div id="collapseSuccess" class="accordion-collapse collapse" aria-labelledby="headingSuccess" data-bs-parent="#apiAccordion">
        <div class="accordion-body">
          <table class="table">
            <thead>
              <tr>
                <th>Campo</th>
                <th>Tipo</th>
                <th>Descrição</th>
              </tr>
            </thead>
            <tbody>
              ${info.success
                .filter((s) => s.type !== "Example")
                .map(
                  (s) => `
                <tr>
                  <td>${escapeHtml(s.name)}</td>
                  <td>${escapeHtml(s.type)}</td>
                  <td>${escapeHtml(s.description)}</td>
                </tr>
              `
                )
                .join("")}
            </tbody>
          </table>
          ${
            exampleContent
              ? `
            <h4>Exemplo:</h4>
            ${exampleContent}
          `
              : ""
          }
        </div>
      </div>
    </div>
  `;
        }

        function generateErrorSection(info) {
          if (!Array.isArray(info.error) || info.error.length === 0) {
            return "";
          }

          const errorRows = info.error
            .filter((err) => err.group && err.type && err.description)
            .map(
              (err) => `
      <tr>
        <td>${escapeHtml(err.group)}</td>
        <td>${escapeHtml(err.type)}</td>
        <td>${escapeHtml(err.description)}</td>
      </tr>
    `
            )
            .join("");

          const errorExamples = info.description
            .split("HTTP/1.1")
            .slice(1) // Inclui todos os exemplos começando com "HTTP/1.1"
            .filter((example) => !example.trim().startsWith("200 OK")) // Filtra exemplos que não são de sucesso
            .map((example) => {
              console.log("Exemplo de erro antes da formatação:", example);
              const { statusLine, jsonContent } = formatJsonExample({ description: "HTTP/1.1" + example.trim() });
              console.log("Exemplo de erro após formatação:", { statusLine, jsonContent });

              return `
        <h4>${escapeHtml(statusLine)}</h4>
        <pre><code class="language-json">${escapeHtml(jsonContent)}</code></pre>
      `;
            })
            .join("");

          return `
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingError">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseError" aria-expanded="false" aria-controls="collapseError">
          Respostas de Erro
        </button>
      </h2>
      <div id="collapseError" class="accordion-collapse collapse" aria-labelledby="headingError" data-bs-parent="#apiAccordion">
        <div class="accordion-body">
          <table class="table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Tipo</th>
                <th>Descrição</th>
              </tr>
            </thead>
            <tbody>
              ${errorRows}
            </tbody>
          </table>
          <h3>Exemplos de Erro:</h3>
          ${errorExamples || "<p>Não há exemplos de erro disponíveis.</p>"}
        </div>
      </div>
    </div>
  `;
        }

        function formatJsonExample(example) {
          if (!example || !example.description) return { statusLine: "", jsonContent: "" };

          let content = example.description.trim();
          let statusLine = "";
          let jsonContent = "";

          // Tentar capturar o status HTTP no exemplo ("Error XXX:" ou "HTTP/1.1 XXX ...")
          const statusMatch = content.match(/(?:HTTP\/\d\.\d|\bError\b)\s+(\d{3}\s+[A-Za-z\s]+)/);

          if (statusMatch) {
            statusLine = statusMatch[0].trim();
            // Remova o status da linha do restante do conteúdo
            content = content.slice(statusMatch.index + statusMatch[0].length).trim();
          }

          // Capturando o JSON no exemplo
          try {
            const jsonStart = content.indexOf("{");
            const jsonEnd = content.lastIndexOf("}") + 1;

            if (jsonStart !== -1 && jsonEnd !== -1 && jsonStart < jsonEnd) {
              const jsonStr = content.slice(jsonStart, jsonEnd);
              const jsonObject = JSON.parse(jsonStr);

              // Formate o conteúdo do JSON como string
              jsonContent = JSON.stringify(jsonObject, null, 2);
            } else {
              jsonContent = content; // Caso não seja JSON, retorne o conteúdo original
            }
          } catch (e) {
            console.warn("Erro ao processar JSON. Retornando conteúdo original:", e);
            jsonContent = content;
          }

          return { statusLine, jsonContent };
        }

        function generateErrorSection(info) {
          if (!Array.isArray(info.error) || info.error.length === 0) {
            return "";
          }

          const errorRows = info.error
            .filter((err) => err.group && err.type && err.description)
            .map(
              (err) => `
      <tr>
        <td>${escapeHtml(err.group)}</td>
        <td>${escapeHtml(err.type)}</td>
        <td>${escapeHtml(err.description)}</td>
      </tr>
    `
            )
            .join("");

          const errorExamples = info.description
            .split("HTTP/1.1")
            .slice(1) // Inclui todos os exemplos começando com "HTTP/1.1"
            .filter((example) => !example.trim().startsWith("200 OK")) // Filtra exemplos que não são de sucesso
            .map((example) => {
              console.log("Exemplo de erro antes da formatação:", example);
              const { statusLine, jsonContent } = formatJsonExample({ description: "HTTP/1.1" + example.trim() });
              console.log("Exemplo de erro após formatação:", { statusLine, jsonContent });

              return `
        <h4>${escapeHtml(statusLine)}</h4>
        <pre><code class="language-json">${escapeHtml(jsonContent)}</code></pre>
      `;
            })
            .join("");

          return `
    <div class="accordion-item">
      <h2 class="accordion-header" id="headingError">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseError" aria-expanded="false" aria-controls="collapseError">
          Respostas de Erro
        </button>
      </h2>
      <div id="collapseError" class="accordion-collapse collapse" aria-labelledby="headingError" data-bs-parent="#apiAccordion">
        <div class="accordion-body">
          <table class="table">
            <thead>
              <tr>
                <th>Código</th>
                <th>Tipo</th>
                <th>Descrição</th>
              </tr>
            </thead>
            <tbody>
              ${errorRows}
            </tbody>
          </table>
          <h3>Exemplos de Erro:</h3>
          ${errorExamples || "<p>Não há exemplos de erro disponíveis.</p>"}
        </div>
      </div>
    </div>
  `;
        }

        function generateHeadersSection(headers) {
          if (!Array.isArray(headers) || headers.length === 0) {
            return "";
          }
          return `
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingHeaders">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHeaders" aria-expanded="false" aria-controls="collapseHeaders">
            Headers
          </button>
        </h2>
        <div id="collapseHeaders" class="accordion-collapse collapse" aria-labelledby="headingHeaders" data-bs-parent="#apiAccordion">
          <div class="accordion-body">
            <table class="table">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Tipo</th>
                  <th>Descrição</th>
                </tr>
              </thead>
              <tbody>
                ${headers
                  .map(
                    (h) => `
                    <tr>
                      <td>${h.name}</td>
                      <td>${h.type}</td>
                      <td>${h.description}</td>
                    </tr>
                  `
                  )
                  .join("")}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    `;
        }

        function generateSecuritySection(info) {
          if (!info.securityDefinition && (!Array.isArray(info.security) || info.security.length === 0)) {
            return "";
          }
          return `
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingSecurity">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSecurity" aria-expanded="false" aria-controls="collapseSecurity">
            Segurança
          </button>
        </h2>
        <div id="collapseSecurity" class="accordion-collapse collapse" aria-labelledby="headingSecurity" data-bs-parent="#apiAccordion">
          <div class="accordion-body">
            ${info.securityDefinition ? `<p><strong>Definição de Segurança:</strong> ${info.securityDefinition}</p>` : ""}
            ${
              Array.isArray(info.security) && info.security.length > 0
                ? `
                <p><strong>Segurança Requerida:</strong></p>
                <ul>
                  ${info.security.map((s) => `<li>${s}</li>`).join("")}
                </ul>
              `
                : ""
            }
          </div>
        </div>
      </div>
    `;
        }

        function generateTryItOutSection(info) {
          const pathParams = info.path ? info.path.match(/:[a-zA-Z]+/g) || [] : [];
          const queryParams = Array.isArray(info.params)
            ? info.params.filter((param) => {
                if (typeof param === "string") {
                  const paramName = param.split(" ")[0];
                  return !pathParams.includes(`:${paramName}`);
                } else if (typeof param === "object" && param.name) {
                  return !pathParams.includes(`:${param.name}`);
                }
                return false;
              })
            : [];

          return `
      <div class="accordion-item try-it-out-accordion">
        <h2 class="accordion-header" id="headingTryItOut">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTryItOut" aria-expanded="false" aria-controls="collapseTryItOut">
            Try it out
          </button>
        </h2>
        <div id="collapseTryItOut" class="accordion-collapse collapse" aria-labelledby="headingTryItOut" data-bs-parent="#apiAccordion">
          <div class="accordion-body">
            <h3>Testar Endpoint</h3>
            ${pathParams
              .map((param) => {
                const paramName = param.slice(1);
                return `
                  <div class="mb-3">
                    <label for="${paramName}" class="form-label">${paramName}</label>
                    <input type="text" class="form-control" id="${paramName}" placeholder="Digite o ${paramName}">
                  </div>`;
              })
              .join("")}
            ${queryParams
              .map((param) => {
                const name = typeof param === "string" ? param.split(" ")[0] : param.name || "";
                const type = typeof param === "string" ? param.split(" ")[1] : param.type || "";
                return `
                  <div class="mb-3">
                    <label for="${name}" class="form-label">${name}</label>
                    <input type="text" class="form-control" id="${name}" placeholder="${type}">
                  </div>`;
              })
              .join("")}
            <button class="btn btn-success" onclick="testEndpoint('${info.method || ""}', '${info.path || ""}')" aria-label="Executar teste">Execute</button>
            <button class="btn btn-secondary" onclick="clearInputs(this)" aria-label="Limpar campos">Limpar</button>
            <div id="testOutput" class="response-container mt-3" style="display: none;">
              <div class="response-header">Resposta:</div>
              <div class="response-body position-relative">
                <button class="copy-button" onclick="copyResponse(this)">Copiar</button>
                <pre><code class="language-json"></code></pre>
              </div>
              <div class="format-selector">
                <label for="formatSelect" class="form-label">Formato de saída:</label>
                <select id="formatSelect" class="form-select" onchange="changeOutputFormat(this)">
                  <option value="json" selected>JSON</option>
                  <option value="xml">XML</option>
                  <option value="yaml">YAML</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
        }

        function logExamples(api) {
          console.log("Description examples:");
          api.description
            .split("HTTP/1.1")
            .slice(1)
            .forEach((example, index) => {
              console.log(`Example ${index + 1}:`, example.trim());
            });

          console.log("Success example:");
          const successExample = api.success.find((s) => s.type === "Example");
          console.log(successExample);

          console.log("Error examples:");
          const errorExamples = api.error.filter((e) => e.type === "Example");
          errorExamples.forEach((example, index) => {
            console.log(`Error example ${index + 1}:`, example);
          });
        }

        // Função principal para gerar o HTML da API
        function generateApiHtml(info) {
          if (!info || typeof info !== "object") {
            console.error("Invalid info object:", info);
            return "<p>Error: Invalid API information</p>";
          }

          const description = info.description.split("HTTP/1.1")[0];

          return `
    <div class="api-item">
      <div class="api-item-header">
        <span class="method ${(info.method || "").toLowerCase()}">${escapeHtml(info.method || "Unknown")}</span>
        <span class="path">${escapeHtml(info.path || "")}</span>
        <span class="version-tag">v${escapeHtml(info.version || "1.0.0")}</span>
      </div>
      <div class="api-item-content">
        ${
          info.sampleRequest
            ? `
            <div class="sample-request">
              <p>Sample Request:</p>
              <pre><code class="language-json">${escapeHtml(info.sampleRequest)}</code></pre>
            </div>
          `
            : ""
        }
        
        <hr>

        <h2>${escapeHtml(info.name || info.summary || "No name/summary provided")}</h2>
        <p><strong>Group:</strong> ${escapeHtml(info.group || "Not specified")}</p>
        
        <div class="description">
          <p>${escapeHtml(description.trim())}</p>
        </div>

        ${
          info.deprecated
            ? `
            <div class="deprecated">
              <strong>Deprecated:</strong> Este endpoint está obsoleto e será removido em versões futuras.
              ${info.deprecatedMessage ? `<br>${escapeHtml(info.deprecatedMessage)}` : ""}
            </div>
          `
            : ""
        }

        ${
          info.notes
            ? `
            <div class="notes">
              <h4>Notas Adicionais:</h4>
              <p>${escapeHtml(info.notes)}</p>
            </div>
          `
            : ""
        }

        <div class="accordion" id="apiAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingParameters">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseParameters" aria-expanded="true" aria-controls="collapseParameters">
                Parâmetros
              </button>
            </h2>
            <div id="collapseParameters" class="accordion-collapse collapse show" aria-labelledby="headingParameters" data-bs-parent="#apiAccordion">
              <div class="accordion-body">
                ${generateParametersSection(info.params)}
              </div>
            </div>
          </div>

          ${generateHeadersSection(info.headers)}
          ${generateSuccessSection(info)}
          ${generateErrorSection(info)}
          ${generateSecuritySection(info)}
          ${generateTryItOutSection(info)}
        </div>
      </div>
    </div>
  `;
        }

        function renderSidebar() {
          const sidebarContent = document.getElementById("sidebar-content");
          const fragment = document.createDocumentFragment();
          apiDocs.forEach((api, index) => {
            logApiStructure(api, index);
            logExamples(api);
            const item = document.createElement("div");
            item.className = "sidebar-item";
            item.textContent = `${api.method} ${api.path}`;
            item.onclick = () => showApiItem(index);
            fragment.appendChild(item);
          });
          sidebarContent.appendChild(fragment);
        }

        function showApiItem(index) {
          const apiContent = document.getElementById("api-content");
          apiContent.classList.remove("fade-transition");
          apiContent.style.opacity = 0;

          setTimeout(() => {
            const info = apiDocs[index];
            const generatedHtml = generateApiHtml(info);
            apiContent.innerHTML = generatedHtml;
            apiContent.classList.add("fade-transition");
            apiContent.style.opacity = 1;

            hljs.highlightAll();
          }, 300);
        }

        function extractExamplesFromDescription(description) {
          const examples = [];
          const parts = description.split("HTTP/1.1");
          parts.slice(1).forEach((part, index) => {
            const title = index === 0 ? "Success Response:" : `Error ${index}:`;
            examples.push({
              type: "Example",
              name: "{json}",
              description: title,
              content: "HTTP/1.1" + part.trim(),
            });
          });
          return examples;
        }

        function logApiStructure(api, index) {
          console.log(`API ${index} structure:`, JSON.stringify(api, null, 2));
          console.log("Description:", api.description);
          console.log(
            "Success examples:",
            api.success.filter((s) => s.type === "Example")
          );
          console.log(
            "Error examples:",
            api.error.filter((e) => e.type === "Example")
          );
        }

        // Funções globais
        window.testEndpoint = async function (method, path) {
          try {
            console.log(`Testando endpoint: ${method} ${path}`);
            const accordionBody = event.target.closest(".accordion-body");
            const inputs = accordionBody.querySelectorAll("input");
            const params = {};
            inputs.forEach((input) => {
              if (input.value) {
                params[input.id] = input.value;
              }
            });

            const response = await simulateApiCall(method, path, params);
            displayTestResult(response);
          } catch (error) {
            console.error("Erro ao testar endpoint:", error);
            displayTestResult({
              status: 500,
              data: { error: "Erro interno do servidor", details: error.message },
            });
          }
        };

        async function simulateApiCall(method, path, params) {
          await new Promise((resolve) => setTimeout(resolve, 1000));

          if (Math.random() > 0.2) {
            return {
              status: 200,
              data: {
                message: "Operação bem-sucedida",
                params: params,
                timestamp: new Date().toISOString(),
              },
            };
          } else {
            throw new Error("Falha na operação");
          }
        }

        function displayTestResult(response) {
          const testOutput = document.getElementById("testOutput");
          const codeElement = testOutput.querySelector("pre code");

          testOutput.style.display = "block";
          codeElement.textContent = JSON.stringify(response, null, 2);
          hljs.highlightElement(codeElement);
        }

        window.clearInputs = function (button) {
          const accordionBody = button.closest(".accordion-body");
          const inputs = accordionBody.querySelectorAll("input");
          inputs.forEach((input) => (input.value = ""));
          const testOutput = accordionBody.querySelector("#testOutput");
          testOutput.style.display = "none";
          const outputElement = testOutput.querySelector("pre code");
          outputElement.textContent = "";
        };

        window.copyResponse = function (button) {
          const responseBody = button.closest(".response-body");
          const codeElement = responseBody.querySelector("code");
          const textToCopy = codeElement.textContent;

          navigator.clipboard
            .writeText(textToCopy)
            .then(() => {
              const originalText = button.textContent;
              button.textContent = "Copiado!";
              setTimeout(() => {
                button.textContent = originalText;
              }, 2000);
            })
            .catch((err) => {
              console.error("Erro ao copiar texto: ", err);
            });
        };

        window.changeOutputFormat = function (select) {
          const format = select.value;
          const outputElement = select.closest(".response-container").querySelector("pre code");
          const currentContent = outputElement.textContent;

          let formattedContent;
          switch (format) {
            case "xml":
              formattedContent = jsonToXml(JSON.parse(currentContent));
              break;
            case "yaml":
              formattedContent = jsonToYaml(JSON.parse(currentContent));
              break;
            default:
              formattedContent = currentContent;
          }

          outputElement.textContent = formattedContent;
          hljs.highlightElement(outputElement);
        };

        function jsonToXml(obj) {
          let xml = "";
          for (let prop in obj) {
            xml += obj[prop] instanceof Array ? "" : "<" + prop + ">";
            if (obj[prop] instanceof Array) {
              for (let array in obj[prop]) {
                xml += "<" + prop + ">";
                xml += jsonToXml(new Object(obj[prop][array]));
                xml += "</" + prop + ">";
              }
            } else if (typeof obj[prop] == "object") {
              xml += jsonToXml(new Object(obj[prop]));
            } else {
              xml += obj[prop];
            }
            xml += obj[prop] instanceof Array ? "" : "</" + prop + ">";
          }
          return xml.replace(/<\/?[0-9]{1,}>/g, "");
        }

        function jsonToYaml(obj, indent = "") {
          let yaml = "";
          for (let key in obj) {
            if (obj.hasOwnProperty(key)) {
              if (Array.isArray(obj[key])) {
                yaml += `${indent}${key}:\n`;
                obj[key].forEach((item) => {
                  yaml += `${indent}- ${jsonToYaml(item, indent + "  ")}`;
                });
              } else if (typeof obj[key] === "object") {
                yaml += `${indent}${key}:\n${jsonToYaml(obj[key], indent + "  ")}`;
              } else {
                yaml += `${indent}${key}: ${obj[key]}\n`;
              }
            }
          }
          return yaml;
        }

        // Inicialização
        let apiDocs;
        try {
          const rawJson = decodeURIComponent("{{API_DOCS_JSON}}");
          if (!rawJson.trim()) {
            throw new Error("Empty API_DOCS_JSON");
          }
          apiDocs = JSON.parse(rawJson).filter((api) => api.method && api.path);
          console.log("Parsed API docs:", apiDocs);
        } catch (error) {
          console.error("Erro ao parsear API_DOCS_JSON:", error);
          apiDocs = [];
        }

        renderSidebar();
        if (apiDocs.length > 0) {
          console.log("Showing first API item");
          showApiItem(0);
        } else {
          console.log("No API items to show");
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        document.querySelectorAll("pre code").forEach((block) => {
          hljs.highlightBlock(block);
        });
      });
    </script>
  </body>
</html>
